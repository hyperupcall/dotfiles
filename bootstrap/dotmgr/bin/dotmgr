#!/usr/bin/env bash
set -eo pipefail
shopt -s nullglob

DOTMGR_ROOT_DIR="${0%/*}"; DOTMGR_ROOT_DIR="${DOTMGR_ROOT_DIR%/*}"
source "$DOTMGR_ROOT_DIR/lib/util.sh"

main() {
	trap sigint INT
	sigint() {
		die 'Received SIGINT'
	}

	if ((EUID == 0)); then
		die "Cannot run as root"
	fi

	for arg; do case "$arg" in
	-h|--help)
		util.show_help
		exit
		;;
	esac done

	local subcommand="$1"
	if [ -f "$DOTMGR_ROOT_DIR/lib/commands/$subcommand.sh" ]; then
		shift
		source "$DOTMGR_ROOT_DIR/lib/commands/$subcommand.sh" "$@"
	else
		log_error "No matching subcommand found"
		util.show_help
		exit 1
	fi
}

main "$@"